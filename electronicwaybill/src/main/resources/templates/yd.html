<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>电子运单系统</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
</head>
<body style="font-size:8px; margin: 0;">
<div style="margin:0" id="yd" class="ddr">
    <style>
        #yd .font-weight {
            font-weight: bolder;
            text-align: left;
            border-right: 1px solid #555;
        }

        #yd td {
            padding: 3px;
        }

        .div2 {
            height: 30px;
            position: absolute;
            top: 50%;
            z-index: 8;
            left: 10%;
        }
    </style>
    <!--    <a class="layui-btn layui-btn-primary" href="javascript:mobilePdf();"><font color="#01AAED">下载PDF文件</font></a>&nbsp;&nbsp;-->
    <!--    <a href="javascript:doPrint();" class="layui-btn layui-btn-primary print_table"><font color="#01AAED">打印</font></a>-->
    <div class="ddr" style="margin-top: 20px">
        <!--startprint-->
        <!--        <div class="div2"><img src="/img/yinzhang.png" border="0" width="160px;height=160px;"></div>-->

        <table style="border-collapse:collapse;" border="1" width="100%" cellspacing="0" cellpadding="1">
            <tbody>
            <tr>
                <td colspan="7" align="center" style="font-weight:bolder;text-align:center;">危险货物道路运输运单</td>
            </tr>
            <tr>
                <td th:text="运单编号 + ':'+${yd.waybillCode}" colspan="7" style="text-align:center;text-align:left;">
                    运单编号：371400003520071300056274
                </td>
            </tr>
            <tr>
                <td rowspan="2" style="text-align:center;text-align:center;" width="30">托运人</td>
                <td style="text-align:center;text-align:center;">名称</td>
                <td th:text="${yd.shipperName}" colspan="2">中石化天津</td>
                <td rowspan="2" style="text-align:center;text-align:center;" width="30">收货人</td>
                <td style="text-align:center;text-align:center;" width="40">名称</td>
                <td th:text="${yd.shiptoName}"> 闫升化</td>
            </tr>
            <tr>
                <td style="text-align:center;text-align:center;" width="30">联系电话</td>
                <td th:text="${yd.shipperPhone}" colspan="2">15032208852</td>
                <td style="text-align:center;text-align:center;" width="30">联系电话</td>
                <td th:text="${yd.shiptoPhone}">13630868852</td>
            </tr>
            <tr>
                <td rowspan="2" style="text-align:center;text-align:center;">装货人</td>
                <td style="text-align:center;text-align:center;">名称</td>
                <td th:text="${yd.shipmentName}" colspan="2"> 李刚磊</td>
                <td style="text-align:center;text-align:center;">起运日期</td>
                <td th:text="${yd.shipmentStarttime}" colspan="2">2020-07-13</td>
            </tr>
            <tr>
                <td style="text-align:center;text-align:center;">联系电话</td>
                <td th:text="${yd.shipmentPhone}" colspan="2"> 18925556666</td>
                <td style="text-align:center;text-align:center;">起运地</td>
                <td th:text="${yd.shipmentFromAddress}" colspan="2"> 济南</td>
            </tr>
            <tr>
                <td style="text-align:center;text-align:center;">目的地</td>
                <td th:text="${yd.shipmentToAddress}" colspan="4"> 沧州</td>
                <td colspan="2" style="text-align:center;text-align:left;">城市配送
                </td>
            </tr>
            <tr>
                <td rowspan="8" style="text-align:center;text-align:center;">承运人</td>
                <td style="text-align:center;text-align:center;">单位名称</td>
                <td th:text="${yd.carriageName}" colspan="2">山东易罐云物流有限公司</td>
                <td style="text-align:center;text-align:center;">联系电话</td>
                <td th:text="${yd.carriagePhone}" colspan="2">18053407653</td>
            </tr>
            <tr>
                <td style="text-align:center;text-align:center;">许可证号</td>
                <td th:text="${yd.carriageLicensekey}" colspan="5"> 371401000035</td>
            </tr>
            <tr>
                <td rowspan="2" style="text-align:center;text-align:center;">车辆信息</td>
                <td style="text-align:center;text-align:center;">车牌号码(颜色)</td>
                <td th:text="|${yd.licensePlateNum}(${yd.licensePlateColor})|">鲁NE8899(黄牌)</td>
                <td rowspan="2" style="text-align:center;text-align:center;">挂车信息</td>
                <td style="text-align:center;text-align:center;">车牌号码</td>
                <td th:text="${yd.licensePlateNum}">鲁NE5522挂</td>
            </tr>
            <tr>
                <td style="text-align:center;text-align:center;">道路运输证号</td>
                <td th:text="${yd.trailerRoadRansportPermit}">3216541265456</td>
                <td style="text-align:center;text-align:center;">道路运输证号</td>
                <td th:text="${yd.trailerRoadRansportPermit}">313216921322</td>
            </tr>
            <tr>
                <td style="text-align:center;text-align:center;">罐体信息</td>
                <td style="text-align:center;text-align:center;">罐体编号</td>
                <td th:text="${yd.canbodyNum}" colspan="2">5131325321</td>
                <td style="text-align:center;text-align:center;">罐体容积</td>
                <td th:text="${yd.canbodyVolume}">36</td>
            </tr>
            <tr>
                <td rowspan="3" style="text-align:center;text-align:center;">驾驶员</td>
                <td style="text-align:center;text-align:center;">姓名</td>
                <td th:text="${yd.driverName}">杜立辉</td>
                <td rowspan="3" style="text-align:center;text-align:center;">押运员</td>
                <td style="text-align:center;text-align:center;">姓名</td>
                <td th:text="${yd.escortCertificate}">34531561222</td>
            </tr>
            <tr>
                <td style="text-align:center;text-align:center;">从业资格证</td>
                <td th:text="${yd.driverCertificate}">3714221999999</td>
                <td style="text-align:center;text-align:center;">从业资格证</td>
                <td th:text="${yd.escortCertificate}">34531561222</td>
            </tr>
            <tr>
                <td style="text-align:center;text-align:center;">联系电话</td>
                <td th:text="${yd.driverPhone}">15668321122</td>
                <td style="text-align:center;text-align:center;">联系电话</td>
                <td th:text="${yd.escortPhone}">15822335555</td>
            </tr>
            <tr>
                <td style="text-align:center;text-align:center;">货物信息</td>
                <td th:text="|${yd.unNum},${yd.goodsName}, ${yd.goodsType},${yd.goodsPackingType},${yd.goodsNum} ,${yd.goodsCompany}|"
                    style="text-align:center;text-align:center;" colspan="6">UN编号
                </td>
            </tr>
            <tr>
                <td style="text-align:center;text-align:center;">备注</td>
                <td th:text="${yd.remarks}" colspan="4">-</td>
                <td colspan="2" valign="middle" align="center" class="img-w" id="qrcode">
                    <img id="imagesqrcode" width="60" height="60"></td>
            </tr>
            <tr>
                <td style="text-align:center;" colspan="2">调度人:</td>
                <td th:text="${yd.dispatcherName}" colspan="2">李明</td>
                <td colspan="2" style="text-align:left;">调度日期:</td>
                <td th:text="${yd.dispatcherDate}">2020-07-13</td>
            </tr>
            </tbody>
        </table>

        <!--endprint--></div>
</div>
<script src="/js/html2canvas.js"></script>
<script src="/js/jspdf.debug.js"></script>
<script>
    let url = ''

    function getlianjie() {
        url = '/waybill/qrimage?codestr=' + window.location.href
        document.getElementById('imagesqrcode').src = url
        console.log(url)
        return window.location.href;
    }

    getlianjie()


    //转pdf文件
    function doPrint() {
        bdhtml = window.document.body.innerHTML;
        sprnstr = "<!--startprint-->";
        eprnstr = "<!--endprint-->";
        prnhtml = bdhtml.substr(bdhtml.indexOf(sprnstr) + 17);
        prnhtml = prnhtml.substring(0, prnhtml.indexOf(eprnstr));
        window.document.body.innerHTML = prnhtml;
        window.print();
    }

    function mobilePdf() {
        var target = document.getElementsByClassName("ddr")[0];
        target.style.background = "#FFFFFF";

        html2canvas(target, {
            onrendered: function (canvas) {
                var contentWidth = canvas.width;
                var contentHeight = canvas.height;

                //一页pdf显示html页面生成的canvas高度;
                var pageHeight = contentWidth / 592.28 * 841.89;
                //未生成pdf的html页面高度
                var leftHeight = contentHeight;
                //页面偏移
                var position = 0;
                //a4纸的尺寸[595.28,841.89]，html页面生成的canvas在pdf中图片的宽高
                var imgWidth = 595.28;
                var imgHeight = 592.28 / contentWidth * contentHeight;

                var pageData = canvas.toDataURL('image/jpeg', 1.0);

                var pdf = new jsPDF('', 'pt', 'a4');

                //有两个高度需要区分，一个是html页面的实际高度，和生成pdf的页面高度(841.89)
                //当内容未超过pdf一页显示的范围，无需分页
                if (leftHeight < pageHeight) {
                    pdf.addImage(pageData, 'JPEG', 0, 0, imgWidth, imgHeight);
                } else {
                    while (leftHeight > 0) {
                        pdf.addImage(pageData, 'JPEG', 0, position, imgWidth, imgHeight)
                        leftHeight -= pageHeight;
                        position -= 841.89;
                        //避免添加空白页
                        if (leftHeight > 0) {
                            pdf.addPage();
                        }
                    }
                }

                pdf.save("content.pdf");
            }
        })
    }
</script>

</body>
</html>